<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>TÆ°á»ng lá»­a há»c táº­p</title>
</head>
<body>
    <h1>ğŸ“š TÆ°á»ng lá»­a há»c táº­p</h1>

    <!-- Thiáº¿t láº­p giá» há»c -->
    <form method="POST" action="/">
        <label>Giá» báº¯t Ä‘áº§u:</label>
        <input type="time" name="start_time" value="{{ study_time.start }}" required><br><br>

        <label>Giá» káº¿t thÃºc:</label>
        <input type="time" name="end_time" value="{{ study_time.end }}" required><br><br>

        <button type="submit" name="action" value="set_time">LÆ°u giá» há»c</button>
    </form>

    <hr>

    <!-- ThÃªm website vÃ o danh sÃ¡ch -->
    <form method="POST" action="/">
        <label>ThÃªm website bá»‹ cháº·n:</label>
        <input type="text" name="site_to_add" placeholder="facebook.com" required>
        <button type="submit" name="action" value="add_site">ThÃªm</button>
    </form>

    <!-- Hiá»ƒn thá»‹ danh sÃ¡ch Ä‘ang bá»‹ cháº·n -->
    {% if blocked_sites %}
        <h3>ğŸ“‹ Danh sÃ¡ch website bá»‹ cháº·n:</h3>
        <ul>
        {% for site in blocked_sites %}
            <li>
                {{ site }}
                <form method="POST" action="/" style="display:inline;">
                    <input type="hidden" name="site_to_delete" value="{{ site }}">
                    <button type="submit" name="action" value="delete_site">XÃ³a</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    {% endif %}

    <p style="color:green;">{{ message }}</p>
    <hr>
    <h3>â³ Thá»i gian há»c cÃ²n láº¡i:</h3>
    <p id="countdown">Äang táº£i...</p>

    <script>
    // Láº¥y giá» há»c tá»« Flask (Ä‘á»‹nh dáº¡ng: "HH:MM")
    const startTimeStr = "{{ study_time.start or '' }}";
    const endTimeStr = "{{ study_time.end or '' }}";

    if (startTimeStr && endTimeStr) {
        const now = new Date();
        const [endHour, endMinute] = endTimeStr.split(":").map(Number);
        const [startHour, startMinute] = startTimeStr.split(":").map(Number);

        const endTime = new Date(now);
        endTime.setHours(endHour, endMinute, 0, 0);

        const startTime = new Date(now);
        startTime.setHours(startHour, startMinute, 0, 0);

        // Náº¿u qua ná»­a Ä‘Ãªm
        if (endTime <= startTime) {
            if (now < startTime) {
                startTime.setDate(startTime.getDate() - 1);
            } else {
                endTime.setDate(endTime.getDate() + 1);
            }
        }

        function updateCountdown() {
            const current = new Date();
            if (current < startTime) {
                document.getElementById("countdown").innerText = "ChÆ°a Ä‘áº¿n giá» há»c.";
            } else if (current >= startTime && current <= endTime) {
                const diff = endTime - current;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                document.getElementById("countdown").innerText =
                    `${hours} giá» ${minutes} phÃºt ${seconds} giÃ¢y`;
            } else {
                document.getElementById("countdown").innerText = "ÄÃ£ háº¿t giá» há»c.";
            }
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);
    } else {
        document.getElementById("countdown").innerText = "ChÆ°a thiáº¿t láº­p thá»i gian há»c.";
    }
    </script>

</body>
</html>
